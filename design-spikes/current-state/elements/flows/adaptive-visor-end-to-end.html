<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adaptive Visor End-to-End Storyboard</title>
    <link rel="stylesheet" href="../../../../packages/web/src/styles.css" />
    <style>
      :root {
        --flow-bg-0: #06070e;
        --flow-bg-1: #0b0d17;
        --flow-line: rgba(131, 114, 250, 0.34);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        color: var(--text);
        background:
          radial-gradient(circle at 14% 8%, rgba(124, 108, 240, 0.24), transparent 36%),
          radial-gradient(circle at 86% 0%, rgba(96, 220, 255, 0.12), transparent 28%),
          linear-gradient(180deg, var(--flow-bg-0), var(--flow-bg-1));
        padding: 18px;
      }

      .shell {
        max-width: 1240px;
        margin: 0 auto;
        display: grid;
        gap: 12px;
      }

      .card {
        border: 1px solid var(--flow-line);
        border-radius: 14px;
        background: rgba(11, 12, 22, 0.86);
        padding: 14px;
      }

      .kicker {
        margin: 0;
        font-family: var(--hud-mono);
        font-size: 10px;
        letter-spacing: 1px;
        text-transform: uppercase;
        color: var(--hud-text);
      }

      h1 {
        margin: 6px 0;
        font-size: clamp(26px, 4.3vw, 38px);
        line-height: 1.08;
      }

      .summary {
        margin: 0;
        color: var(--text-dim);
        font-size: 13px;
        max-width: 940px;
      }

      .badges {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .badge {
        border: 1px solid var(--hud-border);
        border-radius: 999px;
        padding: 4px 8px;
        font-family: var(--hud-mono);
        font-size: 10px;
        letter-spacing: 0.6px;
        color: var(--hud-text);
        background: rgba(124, 108, 240, 0.12);
      }

      .grid {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .flow-step {
        border: 1px solid rgba(124, 108, 240, 0.24);
        border-radius: 12px;
        overflow: hidden;
        background: rgba(6, 7, 13, 0.66);
      }

      .flow-head {
        padding: 10px 12px;
        border-bottom: 1px solid rgba(124, 108, 240, 0.18);
        display: grid;
        gap: 5px;
      }

      .flow-head h2 {
        margin: 0;
        font-size: 15px;
      }

      .flow-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .flow-pill {
        border: 1px solid var(--hud-border);
        border-radius: 999px;
        padding: 3px 8px;
        font-family: var(--hud-mono);
        font-size: 10px;
        letter-spacing: 0.6px;
        color: var(--hud-text);
        background: rgba(124, 108, 240, 0.1);
      }

      .stage {
        position: relative;
        min-height: 280px;
        padding: 12px;
        background: radial-gradient(circle at 10% 6%, rgba(124, 108, 240, 0.16), transparent 34%), rgba(8, 9, 14, 0.86);
      }

      .stage .hud,
      .stage .adaptive-visor-surface,
      .stage .visor-view {
        position: relative;
      }

      .stage .visor-view {
        top: 0;
        left: 0;
        right: 0;
        bottom: auto;
      }

      .stage .visor-widget-lane {
        position: absolute;
        top: 8px;
        right: 8px;
      }

      .stage .hud-map-actions-container {
        position: static;
        margin-top: 8px;
      }

      .stage .visor-panel-main-slot,
      .stage .visor-panel-secondary-row,
      .stage .visor-history-nav {
        position: relative;
        top: auto;
        left: auto;
        right: auto;
      }

      .stage .visor-panel-collapsed-rail--viewport-bottom-left {
        position: relative;
        left: auto;
        bottom: auto;
        margin-top: 8px;
      }

      .flow-foot {
        padding: 10px 12px;
        border-top: 1px solid rgba(124, 108, 240, 0.18);
        background: rgba(10, 11, 18, 0.72);
      }

      .flow-foot p {
        margin: 0;
        font-size: 12px;
        color: var(--text-dim);
      }

      .back {
        color: var(--text-dim);
        font-size: 12px;
      }

      .back a {
        color: var(--accent);
      }

      @media (max-width: 980px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <main class="shell">
      <section class="card">
        <p class="kicker">Storyboard Spike</p>
        <h1>Adaptive Visor End-to-End Flow</h1>
        <p class="summary">
          This page sequences the implemented visor journey as static frames: state drives rendering, and each transition
          is caused by a mutation event that updates the visor state model.
        </p>
        <div class="badges">
          <span class="badge">Map -> Threshold -> Organism -> Sections</span>
          <span class="badge">Event mutated</span>
          <span class="badge">State rendered</span>
          <span class="badge">Design-first storyboard</span>
        </div>
      </section>

      <section class="grid">
        <article class="flow-step">
          <header class="flow-head">
            <h2>1. Map Idle</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: session.entered</span>
              <span class="flow-pill">Visor state: map</span>
            </div>
          </header>
          <div class="stage">
            <div class="adaptive-visor-surface">
              <div class="visor-widget-lane"><div class="compass"><span class="compass-label">N</span></div></div>
              <div class="hud-map-actions-container">
                <div class="hud-map-actions">
                  <button class="hud-map-btn">Threshold</button>
                  <button class="hud-map-btn">My Organisms</button>
                  <button class="hud-map-btn">Templates</button>
                </div>
              </div>
              <div class="visor-panel-collapsed-rail visor-panel-collapsed-rail--viewport-bottom-left">
                <button class="visor-panel-collapsed-chip">Threshold</button>
                <button class="visor-panel-collapsed-chip">My organisms</button>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>Collapsed rails and map widgets are visible, no promoted panel in main slot yet.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>2. Threshold Promoted</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: visor.panel.promote.threshold</span>
              <span class="flow-pill">Visor state: map + threshold main</span>
            </div>
          </header>
          <div class="stage">
            <div class="visor-panel-main-slot">
              <div class="visor-panel-main">
                <div class="visor-panel-main-header">
                  <h4>Threshold</h4>
                  <div class="visor-panel-main-actions"><button class="hud-action-btn visor-panel-action-btn">Collapse</button></div>
                </div>
                <div class="visor-panel-main-body">
                  <div class="threshold-form threshold-form--inline">
                    <div class="threshold-form-header"><h2>Threshold Organism</h2></div>
                    <input value="Solar Tide" />
                    <textarea rows="4">{ "title": "Solar Tide", "status": "draft" }</textarea>
                    <div class="form-actions"><button type="button">Threshold</button></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>The threshold form occupies main slot while map context remains active.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>3. Threshold Success Cue</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: threshold.completed</span>
              <span class="flow-pill">Visor state: map + cue + organism available</span>
            </div>
          </header>
          <div class="stage">
            <div class="hud-cue-layer">
              <div class="hud-cue">
                <h4>Threshold complete</h4>
                <p>Solar Tide crossed threshold and is now available in your organisms panel.</p>
              </div>
            </div>
            <div class="visor-panel-collapsed-rail visor-panel-collapsed-rail--viewport-bottom-left">
              <button class="visor-panel-collapsed-chip">My organisms</button>
              <button class="visor-panel-collapsed-chip">Templates</button>
            </div>
          </div>
          <footer class="flow-foot"><p>Successful threshold emits cue and returns to map without forced panel lock.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>4. Organism Panel Open</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: visor.organism.open</span>
              <span class="flow-pill">Visor state: visor-organism</span>
            </div>
          </header>
          <div class="stage">
            <div class="visor-panel-main-slot">
              <div class="visor-panel-main">
                <div class="visor-panel-main-header">
                  <h4>Solar Tide</h4>
                  <div class="visor-panel-main-actions"><button class="hud-action-btn visor-panel-action-btn">Close</button></div>
                </div>
                <div class="visor-panel-main-body">
                  <header class="hud-organism-header">
                    <h3>Solar Tide</h3>
                    <p>song • regulated</p>
                  </header>
                  <div class="hud-organism-nav">
                    <button class="hud-chip is-active">Overview</button>
                    <button class="hud-chip">Composition</button>
                    <button class="hud-chip">Proposals</button>
                    <button class="hud-chip">History</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>The focused organism context replaces map panel defaults and enables organism widgets.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>5. Composition Section</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: visor.section.select.composition</span>
              <span class="flow-pill">Visor state: visor-organism + composition</span>
            </div>
          </header>
          <div class="stage">
            <div class="hud-panel hud-panel--composition">
              <div class="hud-panel-inner">
                <header class="hud-section-header"><h3>Composition</h3><p>Boundary composition and children.</p></header>
                <div class="hud-composition-grid">
                  <article class="hud-composition-card"><h4>child-01</h4><p>text organism</p></article>
                  <article class="hud-composition-card"><h4>child-02</h4><p>audio organism</p></article>
                </div>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>Section transition changes panel body while retaining shared organism shell context.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>6. Proposal Open</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: visor.section.select.propose</span>
              <span class="flow-pill">Visor state: regulated -> open proposal</span>
            </div>
          </header>
          <div class="stage">
            <div class="hud-panel hud-panel--propose">
              <div class="hud-panel-inner">
                <header class="hud-section-header"><h3>Open Proposal</h3><p>Offer a new state for integration.</p></header>
                <form class="hud-form-grid">
                  <label>Summary</label>
                  <input value="Tighten chorus melody phrasing" />
                  <label>Payload (JSON)</label>
                  <textarea rows="4">{ "title": "Solar Tide", "status": "proposal" }</textarea>
                  <div class="form-actions"><button type="button">Open Proposal</button></div>
                </form>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>Availability of this panel is policy-aware and only appears for regulated organisms.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>7. Proposals Queue</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: proposal.opened</span>
              <span class="flow-pill">Visor state: regulated -> proposals</span>
            </div>
          </header>
          <div class="stage">
            <div class="hud-panel hud-panel--proposals">
              <div class="hud-panel-inner">
                <header class="hud-section-header"><h3>Proposals</h3><p>Pending integration decisions.</p></header>
                <div class="hud-list">
                  <article class="hud-list-item"><strong>proposal-187</strong><span>Pending • Lumen</span></article>
                  <article class="hud-list-item"><strong>proposal-186</strong><span>Integrated • Sol</span></article>
                </div>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>The queue confirms transition success and closes the propose -> evaluate loop.</p></footer>
        </article>

        <article class="flow-step">
          <header class="flow-head">
            <h2>8. Return To Map</h2>
            <div class="flow-meta">
              <span class="flow-pill">Event: visor.organism.close</span>
              <span class="flow-pill">Visor state: map</span>
            </div>
          </header>
          <div class="stage">
            <div class="adaptive-visor-surface">
              <div class="hud-map-actions-container">
                <div class="hud-map-actions">
                  <button class="hud-map-btn">Threshold</button>
                  <button class="hud-map-btn hud-map-btn--active">My Organisms</button>
                  <button class="hud-map-btn">Templates</button>
                </div>
              </div>
              <div class="visor-panel-collapsed-rail visor-panel-collapsed-rail--viewport-bottom-left">
                <button class="visor-panel-collapsed-chip">Threshold</button>
                <button class="visor-panel-collapsed-chip">Templates</button>
              </div>
            </div>
          </div>
          <footer class="flow-foot"><p>Closing organism focus restores map-first composition and interaction rails.</p></footer>
        </article>
      </section>

      <p class="back">Back to <a href="../index.html">HUD Element Spikes Index</a></p>
    </main>
  </body>
</html>
